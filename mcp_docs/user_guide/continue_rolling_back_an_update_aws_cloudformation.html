<!-- Source URL: https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-continueupdaterollback.html -->
<!DOCTYPE html>
    <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Continue rolling back an update - AWS CloudFormation</title><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="assets_root" content="/assets" /><meta name="target_state" content="using-cfn-updating-stacks-continueupdaterollback" /><meta name="default_state" content="using-cfn-updating-stacks-continueupdaterollback" /><link rel="icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="shortcut icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="canonical" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-continueupdaterollback.html" /><meta name="description" content="For a stack in the UPDATE_ROLLBACK_FAILED state, fix the error that caused the failure and continue rolling back the update to return the stack to a working state (UPDATE_ROLLBACK_COMPLETE)." /><meta name="deployment_region" content="IAD" /><meta name="product" content="AWS CloudFormation" /><meta name="guide" content="User Guide" /><meta name="abstract" content="Create and manage AWS infrastructure deployments predictably and repeatedly using AWS CloudFormation with this User Guide." /><meta name="guide-locale" content="en_us" /><meta name="tocs" content="toc-contents.json" /><link rel="canonical" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-continueupdaterollback.html" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-continueupdaterollback.html" hreflang="id-id" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-continueupdaterollback.html" hreflang="id" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-continueupdaterollback.html" hreflang="de-de" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-continueupdaterollback.html" hreflang="de" /><link rel="alternative" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-continueupdaterollback.html" hreflang="en-us" /><link rel="alternative" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-continueupdaterollback.html" hreflang="en" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-continueupdaterollback.html" hreflang="es-es" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-continueupdaterollback.html" hreflang="es" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-continueupdaterollback.html" hreflang="fr-fr" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-continueupdaterollback.html" hreflang="fr" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-continueupdaterollback.html" hreflang="it-it" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-continueupdaterollback.html" hreflang="it" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-continueupdaterollback.html" hreflang="ja-jp" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-continueupdaterollback.html" hreflang="ja" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-continueupdaterollback.html" hreflang="ko-kr" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-continueupdaterollback.html" hreflang="ko" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-continueupdaterollback.html" hreflang="pt-br" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-continueupdaterollback.html" hreflang="pt" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_cn/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-continueupdaterollback.html" hreflang="zh-cn" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_tw/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-continueupdaterollback.html" hreflang="zh-tw" /><link rel="alternative" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-continueupdaterollback.html" hreflang="x-default" /><meta name="feedback-item" content="CloudFormation" /><meta name="this_doc_product" content="AWS CloudFormation" /><meta name="this_doc_guide" content="User Guide" /><head xmlns="http://www.w3.org/1999/xhtml"> <script defer="" src="/assets/r/awsdocs-doc-page.2.0.0.js"></script><link href="/assets/r/awsdocs-doc-page.2.0.0.css" rel="stylesheet"/></head>
<script defer="" id="awsc-panorama-bundle" type="text/javascript" src="https://prod.pa.cdn.uis.awsstatic.com/panorama-nav-init.js" data-config="{'appEntity':'aws-documentation','region':'us-east-1','service':'cloudformation'}"></script><meta id="panorama-serviceSubSection" value="User Guide" /><meta id="panorama-serviceConsolePage" value="Continue rolling back an update" /></head><body class="awsdocs awsui"><div class="awsdocs-container"><awsdocs-header></awsdocs-header><awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)"><div id="guide-toc" dom-region="navigation"><awsdocs-toc></awsdocs-toc></div><div id="main-column" dom-region="content" tabindex="-1"><awsdocs-view class="awsdocs-view"><div id="awsdocs-content"><head><title>Continue rolling back an update - AWS CloudFormation</title><meta name="pdf" content="/pdfs/AWSCloudFormation/latest/UserGuide/cfn-ug.pdf#using-cfn-updating-stacks-continueupdaterollback" /><meta name="rss" content="aws-cloudformation-user-guide-updates.rss" /><meta name="forums" content="https://repost.aws/tags/TAm3R3LNU3RfSX9L23YIpo3w" /><meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=CloudFormation&amp;topic_url=https://docs.aws.amazon.com/en_us/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-continueupdaterollback.html" /><meta name="feedback-yes" content="feedbackyes.html?topic_url=https://docs.aws.amazon.com/en_us/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-continueupdaterollback.html" /><meta name="feedback-no" content="feedbackno.html?topic_url=https://docs.aws.amazon.com/en_us/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-continueupdaterollback.html" /><meta name="keywords" content="CloudFormation,AWSCloudFormation,resource provisioning,resource configuration,infrastructure management,CloudFormer,CloudFormation stack,CloudFormation stackset,CloudFormation template,change set,CloudFormation stacks,create a collection of resources as a CloudFormation stack" /><script type="application/ld+json">
{
    "@context" : "https://schema.org",
    "@type" : "BreadcrumbList",
    "itemListElement" : [
      {
        "@type" : "ListItem",
        "position" : 1,
        "name" : "AWS",
        "item" : "https://aws.amazon.com"
      },
      {
        "@type" : "ListItem",
        "position" : 2,
        "name" : "AWS CloudFormation",
        "item" : "https://docs.aws.amazon.com/cloudformation/index.html"
      },
      {
        "@type" : "ListItem",
        "position" : 3,
        "name" : "User Guide",
        "item" : "https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide"
      },
      {
        "@type" : "ListItem",
        "position" : 4,
        "name" : "Managing AWS resources as a single unit with AWS CloudFormation stacks",
        "item" : "https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/stacks.html"
      },
      {
        "@type" : "ListItem",
        "position" : 5,
        "name" : "Monitor stack progress",
        "item" : "https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/monitor-stack-progress.html"
      },
      {
        "@type" : "ListItem",
        "position" : 6,
        "name" : "Continue rolling back an update",
        "item" : "https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/monitor-stack-progress.html"
      }
    ]
}
</script></head><body><div id="main"><div style="display: none"><a href="/pdfs/AWSCloudFormation/latest/UserGuide/cfn-ug.pdf#using-cfn-updating-stacks-continueupdaterollback" target="_blank" rel="noopener noreferrer" title="Open PDF"></a></div><div id="breadcrumbs" class="breadcrumb"><a href="/index.html">Documentation</a><a href="/cloudformation/index.html">AWS CloudFormation</a><a href="Welcome.html">User Guide</a></div><div id="page-toc-src"><a href="#nested-stacks">Continue rolling back from failed nested stack updates</a></div><div id="main-content" class="awsui-util-container"><div id="main-col-body"><awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner><h1 class="topictitle" id="using-cfn-updating-stacks-continueupdaterollback">Continue rolling back an
      update</h1><div class="awsdocs-page-header-container"><awsdocs-page-header></awsdocs-page-header><awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector></div><p>Sometimes, when CloudFormation tries to roll back a stack update, it can't roll back all the
    changes it made during the update process. This is called the
      <code class="code">UPDATE_ROLLBACK_FAILED</code> state. For example, you might have a stack that begins to
    roll back to an old database instance that was deleted outside of CloudFormation. Because CloudFormation
    doesn't know that the database was deleted, it assumes that the database instance still exists
    and attempts to roll back to it, causing the update rollback to fail.</p><p>A stack in the <code class="code">UPDATE_ROLLBACK_FAILED</code> state can't be updated, but it can be
    rolled back to a working state (<code class="code">UPDATE_ROLLBACK_COMPLETE</code>). After returning the
    stack to its original settings, you can try to update it again.</p><p>In most cases, you must fix the error that causes the update rollback to fail before you can
    continue to roll back your stack. In other cases, you can continue to roll back the update
    without any changes, for example when a stack operation times out.</p><div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Note</h6></div><div class="awsdocs-note-text"><p>If you use nested stacks, rolling back the parent stack will attempt to roll back all the
      child stacks as well.</p></div></div><div class="procedure"><h6>To continue rolling
      back an update (console)</h6><ol><li><p>Sign in to the AWS Management Console and open the AWS CloudFormation console at
         <a href="https://console.aws.amazon.com/cloudformation/" rel="noopener noreferrer" target="_blank"><span>https://console.aws.amazon.com/cloudformation</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>.</p></li><li>
      <p>On the navigation bar at the top of the screen, choose the AWS Region where the stack
        is located.</p>
    </li><li>
      <p>On the <b>Stacks</b> page, choose the stack that you want to update,
        choose <b>Stack actions</b>, and then choose <b>Continue update
          rollback</b>.</p>

      <p>If none of the solutions in the <a href="./troubleshooting.html#troubleshooting-errors">Troubleshooting errors</a> worked, you can use the advanced option to skip the
        resources that CloudFormation can't successfully roll back. You must <a href="./cfn-console-view-stack-data-resources.html">look up</a> and type the logical IDs of
        the resources that you want to skip. Specify only resources that went into the
          <code class="code">UPDATE_FAILED</code> state during the <code class="code">UpdateRollback</code> and not during the
        forward update.</p>
      <div class="awsdocs-note awsdocs-warning"><div class="awsdocs-note-title"><awsui-icon name="status-warning" variant="error"></awsui-icon><h6>Warning</h6></div><div class="awsdocs-note-text"><p>CloudFormation sets the status of the specified resources to <code class="code">UPDATE_COMPLETE</code>
          and continues to roll back the stack. After the rollback is complete, the state of the
          skipped resources will be inconsistent with the state of the resources in the stack
          template. Before performing another stack update, you must update the stack or resources
          to be consistent with each other. If you don't, subsequent stack updates might fail, and
          the stack will become unrecoverable.</p></div></div>
      <p>Specify the minimum number of resources required to successfully roll back your stack.
        For example, a failed resource update might cause dependent resources to fail. In this case,
        it might not be necessary to skip the dependent resources.</p>
      <p>To skip resources that are part of nested stacks, use the following format:
            <code class="code"><code class="replaceable">NestedStackName</code>.<code class="replaceable">ResourceLogicalID</code></code>.
        If you want to specify the logical ID of a stack resource (<code class="code">Type:
          AWS::CloudFormation::Stack</code>) in the <code class="code">ResourcesToSkip</code> list, then its
        corresponding embedded stack must be in one of the following states:
          <code class="code">DELETE_IN_PROGRESS</code>, <code class="code">DELETE_COMPLETE</code>, or
          <code class="code">DELETE_FAILED</code>.</p>
    </li></ol></div><div class="procedure"><h6>To continue rolling back
      an update (AWS CLI)</h6><ul><li>
      <p>Use the <a href="https://docs.aws.amazon.com/cli/latest/reference/cloudformation/continue-update-rollback.html">continue-update-rollback</a> command with the
          <code class="code">--stack-name</code> option to specify the ID of the stack that you want to continue
        to roll back.</p>
    </li></ul></div>
    <h2 id="nested-stacks">Continue rolling back from failed nested stack updates</h2>

    <p>When you have multiple stacks nested within each other, you may need to skip resources
      across multiple nested levels to get the full stack hierarchy back to a working state. </p>
    <p>For example, you have a root stack called <code class="code">WebInfra</code> that contains two smaller
      stacks inside it: <code class="code">WebInfra-Compute</code> and <code class="code">WebInfra-Storage</code>. These two
      stacks also have their own nested stacks within them.</p>
    <p>If something goes wrong during an update, and the update process fails, the entire stack
      hierarchy may end up in the <code class="code">UPDATE_ROLLBACK_FAILED</code> state, as shown in the
      following diagram. </p>
    <div class="mediaobject">
       
        <img src="/images/AWSCloudFormation/latest/UserGuide/images/cfn-update-stack-continue-update-rollback_nested-stacks.png" class="aws-docs-img-whiteBg aws-docs-img-padding" alt="A diagram showing a three-level nested stack hierarchy." style="max-width:100%" />
       
       
    </div>
    <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Note</h6></div><div class="awsdocs-note-text"><p>The stack names in this example are truncated for simplicity. Child stack names are
        typically generated by CloudFormation and contain unique random strings, so actual names might
        not be user-friendly.</p></div></div>
    <p>To get the root stack into an operable state using the
        <code class="code">continue-update-rollback</code> command, you must use the
        <code class="code">--resources-to-skip</code> option to skip resources that failed to rollback.</p>
    <p>The following <b>continue-update-rollback</b> example resumes a rollback
      operation from a previously failed stack update. In this example, the
        <code class="code">--resources-to-skip</code> option includes the following items:</p>
    <div class="itemizedlist">
       
       
       
       
    <ul class="itemizedlist"><li class="listitem">
        <p><code class="code"><code class="replaceable">myCustom</code></code></p>
      </li><li class="listitem">
        <p><code class="code"><code class="replaceable">WebInfra-Compute-Asg.myAsg</code></code></p>
      </li><li class="listitem">
        <p><code class="code"><code class="replaceable">WebInfra-Compute-LB.myLoadBalancer</code></code></p>
      </li><li class="listitem">
        <p><code class="code"><code class="replaceable">WebInfra-Storage.DB</code></code></p>
      </li></ul></div>
    <p>For the resources of the root stack, you only need to provide the logical ID, for example,
          <code class="code"><code class="replaceable">myCustom</code></code>. However, for the resources that are
      contained in nested stacks, you must provide both the nested stack name and its logical ID,
      separated by a period. For example,
          <code class="code"><code class="replaceable">WebInfra-Compute-Asg.myAsg</code></code>.</p>
    <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><!--DEBUG: cli (cli)--><code class="nohighlight " data-source="content">aws cloudformation continue-update-rollback --stack-name <code class="replaceable">WebInfra</code> \
    --resources-to-skip <code class="replaceable">myCustom WebInfra-Compute-Asg.myAsg WebInfra-Compute-LB.myLoadBalancer WebInfra-Storage.DB</code></code></pre>
     
      <h6>To find the stack name of a nested stack</h6>
      <p>You can locate it within the child stack's stack ID or Amazon Resource Name
        (ARN).</p>
     
    <p>The following ARN example refers to a stack named
        <code class="code">WebInfra-Storage-Z2VKC706XKXT</code>.</p>
    <pre class="screen">arn:aws:cloudformation:us-east-1:123456789012:stack/WebInfra-Storage-Z2VKC706XKXT/ea9e7f90-54f7-11e6-a032-028f3d2330bd</pre>
     
      <h6>To find the logical ID of a nested stack</h6>
      <p>You can find a child stack's logical ID in the template definition of its parent. In the
        diagram, the <code class="code">LogicalId</code> of the <code class="code">WebInfra-Storage-DB</code> child stack is
          <code class="code">DB</code> in its parent <code class="code">WebInfra-Storage</code>.</p>
     
    <p>In the CloudFormation console, you can also find the logical ID in the <b>Logical
        ID</b> column for the stack resource on the <b>Resources</b> tab or the
        <b>Events</b> tab. For more information, see <a href="./cfn-console-view-stack-data-resources.html">View stack information from the
         CloudFormation console</a>.</p>
  <awsdocs-copyright class="copyright-print"></awsdocs-copyright><awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback></div><noscript><div><div><div><div id="js_error_message"><p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning" /> <strong>Javascript is disabled or is unavailable in your browser.</strong></p><p>To use the Amazon Web Services Documentation, Javascript must be enabled. Please refer to your browser's Help pages for instructions.</p></div></div></div></div></noscript><div id="main-col-footer" class="awsui-util-font-size-0"><div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">Document Conventions</a></div><div class="prev-next"><div id="previous" class="prev-link" accesskey="p" href="./using-cfn-updating-stacks-monitor-stack.html">Monitor stack updates</div><div id="next" class="next-link" accesskey="n" href="./determine-root-cause-for-stack-failures.html">Determine the cause of a stack
            failure</div></div></div><awsdocs-page-utilities></awsdocs-page-utilities></div><div id="quick-feedback-yes" style="display: none;"><div class="title">Did this page help you? - Yes</div><div class="content"><p>Thanks for letting us know we're doing a good job!</p><p>If you've got a moment, please tell us what we did right so we can do more of it.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=CloudFormation&amp;topic_url=https://docs.aws.amazon.com/en_us/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-continueupdaterollback.html"></awsui-button></p></div></div><div id="quick-feedback-no" style="display: none;"><div class="title">Did this page help you? - No</div><div class="content"><p>Thanks for letting us know this page needs work. We're sorry we let you down.</p><p>If you've got a moment, please tell us how we can make the documentation better.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=CloudFormation&amp;topic_url=https://docs.aws.amazon.com/en_us/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-continueupdaterollback.html"></awsui-button></p></div></div></div></body></div></awsdocs-view><div class="page-loading-indicator" id="page-loading-indicator"><awsui-spinner size="large"></awsui-spinner></div></div><div id="tools-panel" dom-region="tools"><awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel></div></awsui-app-layout><awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner></div></body></html>